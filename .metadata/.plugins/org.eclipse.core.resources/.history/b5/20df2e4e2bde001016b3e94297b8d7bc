<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Farmer Registration | KrishiSahayak</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:Poppins;margin:0;padding:0}

/* ðŸŒ„ BACKGROUND IMAGE */
body{
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background:
        linear-gradient(rgba(0,0,0,.55), rgba(0,0,0,.55)),
        url("images/bg.jpg") center/cover no-repeat;
}

/* WIZARD CARD */
.wizard-container{
    width:100%;
    max-width:480px;
    background:#fff;
    border-radius:20px;
    box-shadow:0 15px 40px rgba(0,0,0,.3);
    overflow:hidden;
}

/* HEADER */
.wizard-header{
    background:#7cb62f;
    color:#fff;
    text-align:center;
    padding:25px;
}

/* STEPS */
.progress-wrapper{
    display:flex;
    justify-content:center;
    margin-top:15px;
}
.step-indicator{
    width:35px;
    height:35px;
    border-radius:50%;
    background:rgba(255,255,255,.4);
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:600;
    margin:0 10px;
}
.step-indicator.active{
    background:#fff;
    color:#7cb62f;
}
.step-indicator.completed{
    background:#2c3e50;
    color:#fff;
}

/* BODY */
.form-body{
    padding:25px;
}
.step-content{
    display:none;
}
.step-content.active{
    display:block;
}

input, select{
    width:100%;
    padding:12px;
    margin-bottom:12px;
    border-radius:8px;
    border:1px solid #ddd;
}

/* BUTTONS */
.btn-action{
    width:100%;
    padding:14px;
    background:#7cb62f;
    border:none;
    color:#fff;
    font-size:16px;
    border-radius:10px;
    cursor:pointer;
}
.btn-action:hover{
    background:#689e29;
}
.btn-secondary{
    margin-top:10px;
    background:#f0f0f0;
    color:#333;
}

/* OTP */
.otp-inputs{
    display:flex;
    justify-content:center;
    gap:10px;
}
.otp-box{
    width:45px;
    height:45px;
    font-size:20px;
    text-align:center;
}

/* MOBILE */
@media(max-width:520px){
    .wizard-container{
        margin:15px;
    }
}
</style>
</head>

<body>

<div class="wizard-container">

<div class="wizard-header">
<h2>Create Account</h2>
<p>Join the KrishiSahayak Community</p>

<div class="progress-wrapper">
<div class="step-indicator active">1</div>
<div class="step-indicator">2</div>
<div class="step-indicator">3</div>
</div>
</div>

<div class="form-body">

<!-- STEP 1 -->
<form id="step1Form">
<div class="step-content active" id="step1">

<h3><i class="fas fa-user-circle"></i> Personal Details</h3>

<input name="name" placeholder="Full Name">
<input name="phone" placeholder="Phone Number" maxlength="10">
<input name="email" placeholder="Email">
<input name="passwordHash" type="password" placeholder="Password">
<input type="password" placeholder="Confirm Password">

<button type="button" class="btn-action" onclick="submitStep1(this)">
Next Step <i class="fas fa-arrow-right"></i>
</button>

</div>
</form>

<!-- STEP 2 & 3 -->
<form id="formStep2" action="sussregister" method="post">

<!-- STEP 2 -->
<div class="step-content" id="step2">
<h3><i class="fas fa-shield-alt"></i> Verify Phone</h3>

<div class="otp-inputs">
<input class="otp-box" maxlength="1">
<input class="otp-box" maxlength="1">
<input class="otp-box" maxlength="1">
<input class="otp-box" maxlength="1">
</div>

<button type="button" class="btn-action" onclick="validateStep2()">
Verify & Proceed
</button>

<button type="button" class="btn-action btn-secondary" onclick="showStep(1)">
Back
</button>
</div>

<!-- STEP 3 -->
<div class="step-content" id="step3">
<h3><i class="fas fa-map-marker-alt"></i> Complete Profile</h3>

<select name="language">
<option value="">Preferred Language</option>
<option value="en">English</option>
<option value="hi">Hindi</option>
</select>

<select name="state">
<option value="">State</option>
<option>Punjab</option>
<option>Uttar Pradesh</option>
</select>

<button type="submit" class="btn-action">
Complete Registration <i class="fas fa-rocket"></i>
</button>
</div>

</form>

</div>
</div>

		<script>
						function showStep(stepNumber) {
				    // Hide all steps
				    document.querySelectorAll('.step-content').forEach(step => {
				        step.classList.remove('active');
				    });
				    // Remove active status from indicators
				    document.querySelectorAll('.step-indicator').forEach((ind, index) => {
				        if (index + 1 < stepNumber) ind.classList.add('completed');
				        if (index + 1 === stepNumber) ind.classList.add('active');
				    });
				
				    // Show the specific step
				    document.getElementById('step' + stepNumber).classList.add('active');
				}
				
				function submitStep1(btn) {
				    btn.disabled = true;
				    const originalText = btn.innerHTML;
				    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
				
				    const form = document.getElementById("step1Form");
				    const formData = new FormData(form);
				
				    fetch("/generatedOtp", {
				        method: "POST",
				        body: formData
				    })
				    .then(res => res.json())
				    .then(data => {
				        if (data.status === "OTP_SENT") {
				            showStep(2); // This opens the OTP verification form
				        } else if (data.status === "EMAIL_NULL") {
				            alert("Please provide a valid email address.");
				        } else {
				            alert("Error: " + (data.message || "Could not send OTP"));
				        }
				    })
				    .catch(err => {
				        console.error(err);
				        alert("Server connection failed.");
				    })
				    .finally(() => {
				        btn.disabled = false;
				        btn.innerHTML = originalText;
				    });
				}
				
				
				
				
				function validateStep2() {
				    const otpBoxes = document.querySelectorAll('.otp-box');
				    let otpValue = "";
				    
				    // Combine the 4 individual digits
				    otpBoxes.forEach(input => otpValue += input.value);
				
				    if (otpValue.length < 4) {
				        alert("Please enter the full 4-digit OTP.");
				        return;
				    }
				
				    // Send to backend for verification
				    fetch("/verifyOtp?otp=" + otpValue, {
				        method: "POST"
				    })
				    .then(res => res.json())
				    .then(data => {
				        if (data.status === "VERIFIED") {
				            showStep(3); // Proceed to the final registration step
				        } else {
				            alert("Invalid OTP. Please check your email and try again.");
				            // Optional: Clear boxes on error
				            otpBoxes.forEach(input => input.value = "");
				            otpBoxes[0].focus();
				        }
				    })
				    .catch(() => alert("Verification failed. Server error."));
				}
				
				// Optional: Add auto-focus for OTP boxes
				document.querySelectorAll('.otp-box').forEach((box, index, boxes) => {
				    box.addEventListener('input', () => {
				        if (box.value && index < boxes.length - 1) boxes[index + 1].focus();
				    });
				});
				
				
				
		</script>


</body>
</html>
